# =============================================================================
# HomeGameServer Configuration
# =============================================================================
# Copy this file to .env and fill in your values
# All secrets should be generated with high entropy (32+ characters recommended)

# -----------------------------------------------------------------------------
# Server Configuration
# -----------------------------------------------------------------------------

# Port to listen on (default: 8081)
PORT=8081

# Node environment: development, production, test
NODE_ENV=development

# CORS origin whitelist (comma-separated, e.g., http://localhost:3000,https://example.com)
# Use * for development only (not recommended for production)
ORIGIN_WHITELIST=http://localhost:8081,http://127.0.0.1:8081

# -----------------------------------------------------------------------------
# Security Secrets
# -----------------------------------------------------------------------------

# Session secret for express-session (REQUIRED, 32+ chars)
# Generate with: openssl rand -base64 32
SESSION_SECRET=

# JWT secret for access tokens (REQUIRED, 32+ chars)
# Generate with: openssl rand -base64 32
JWT_SECRET=

# JWT secret for refresh tokens (REQUIRED, 32+ chars)
# Generate with: openssl rand -base64 32
JWT_REFRESH_SECRET=

# Guest session secret (REQUIRED, 32+ chars)
# Generate with: openssl rand -base64 32
GUEST_SESSION_SECRET=

# CSRF token secret (REQUIRED, 32+ chars)
# Generate with: openssl rand -base64 32
CSRF_SECRET=

# Metrics endpoint access token (optional, recommended for production)
METRICS_TOKEN=

# -----------------------------------------------------------------------------
# Game Server Tick Configuration
# -----------------------------------------------------------------------------

# Server tick rate in Hz (default: 30, range: 20-60)
# Higher values provide smoother gameplay but increase CPU usage
TICK_RATE=30

# Snapshot broadcast rate in Hz (default: 10, range: 5-30)
# Full state snapshots sent to clients for reconciliation
SNAPSHOT_RATE=10

# Maximum tick duration warning threshold in ms (default: 10)
# Logs warning if tick takes longer than this
TICK_DURATION_WARNING_MS=10

# Enable deterministic RNG for reproducible game states (default: true)
DETERMINISTIC_RNG=true

# -----------------------------------------------------------------------------
# JWT Token Configuration
# -----------------------------------------------------------------------------

# Access token expiration (default: 15m)
# Valid units: s (seconds), m (minutes), h (hours), d (days)
JWT_ACCESS_TOKEN_EXPIRY=15m

# Refresh token expiration (default: 7d)
JWT_REFRESH_TOKEN_EXPIRY=7d

# JWT issuer (default: homegame-server)
JWT_ISSUER=homegame-server

# JWT audience (default: homegame-client)
JWT_AUDIENCE=homegame-client

# -----------------------------------------------------------------------------
# Session Configuration
# -----------------------------------------------------------------------------

# Session TTL in milliseconds (default: 86400000 = 24 hours)
SESSION_TTL_MS=86400000

# Guest session TTL in milliseconds (default: 172800000 = 48 hours)
GUEST_SESSION_TTL_MS=172800000

# -----------------------------------------------------------------------------
# Rate Limiting
# -----------------------------------------------------------------------------

# HTTP write operations per minute per IP (default: 300)
RATE_LIMIT_WRITE_MAX=300

# Authentication attempts per 5 minutes per IP (default: 10)
AUTH_RATE_LIMIT_MAX=10

# Socket.IO events per second per socket (default: 80)
SOCKET_EVENT_RATE_LIMIT=80

# Socket.IO connections per minute per IP (default: 120)
SOCKET_CONNECTION_RATE_LIMIT=120

# Maximum events in burst before rate limiting (default: 10)
RATE_LIMIT_BURST=10

# -----------------------------------------------------------------------------
# Socket.IO Configuration
# -----------------------------------------------------------------------------

# Maximum HTTP buffer size for Socket.IO messages in bytes (default: 1048576 = 1MB)
# Prevents large payload DoS attacks
MAX_HTTP_BUFFER_SIZE=1048576

# Ping timeout in milliseconds (default: 20000 = 20 seconds)
# Time to wait for pong before considering connection dead
PING_TIMEOUT=20000

# Ping interval in milliseconds (default: 25000 = 25 seconds)
# How often to send ping packets
PING_INTERVAL=25000

# Connection timeout in milliseconds (default: 45000 = 45 seconds)
CONNECTION_TIMEOUT=45000

# -----------------------------------------------------------------------------
# Room Configuration
# -----------------------------------------------------------------------------

# Maximum players per room (default: 8)
MAX_PLAYERS_PER_ROOM=8

# Room idle timeout in milliseconds (default: 1800000 = 30 minutes)
# Rooms with no activity are automatically closed
ROOM_IDLE_TIMEOUT_MS=1800000

# Maximum rooms per server instance (default: 100)
MAX_ROOMS=100

# Enable automatic room cleanup (default: true)
ENABLE_ROOM_CLEANUP=true

# Room cleanup interval in milliseconds (default: 60000 = 1 minute)
ROOM_CLEANUP_INTERVAL_MS=60000

# -----------------------------------------------------------------------------
# Input Validation & Security
# -----------------------------------------------------------------------------

# Maximum payload size for game commands in bytes (default: 10240 = 10KB)
MAX_COMMAND_PAYLOAD_SIZE=10240

# Enable input sanitization (default: true)
ENABLE_INPUT_SANITIZATION=true

# Enable sequence number validation for replay protection (default: true)
ENABLE_SEQUENCE_VALIDATION=true

# Maximum sequence number drift allowed (default: 100)
# Messages with sequence numbers outside this window are rejected
MAX_SEQUENCE_DRIFT=100

# Enable profanity filter (default: true)
ENABLE_PROFANITY_FILTER=true

# -----------------------------------------------------------------------------
# File Upload Configuration
# -----------------------------------------------------------------------------

# Maximum avatar upload size in bytes (default: 2097152 = 2MB)
MAX_UPLOAD_SIZE=2097152

# Avatar maximum dimension in pixels (default: 256)
AVATAR_MAX_DIMENSION=256

# Avatar output format: webp, png (default: webp)
AVATAR_OUTPUT_FORMAT=webp

# -----------------------------------------------------------------------------
# HTTP Body Limits
# -----------------------------------------------------------------------------

# HTTP JSON body limit (default: 256kb)
HTTP_BODY_LIMIT=256kb

# HTTP form body limit (default: 512kb)
FORM_BODY_LIMIT=512kb

# -----------------------------------------------------------------------------
# Redis Configuration (Optional)
# -----------------------------------------------------------------------------

# Redis connection URL (optional, enables caching and pub/sub)
# Example: redis://localhost:6379
# Example with auth: redis://:password@localhost:6379
REDIS_URL=

# Redis key prefix (default: homegame:)
REDIS_KEY_PREFIX=homegame:

# Enable Redis for profile caching (default: false)
ENABLE_REDIS_CACHE=false

# Profile cache TTL in milliseconds (default: 15000 = 15 seconds)
PROFILE_CACHE_TTL_MS=15000

# Profile cache max entries (default: 2000)
PROFILE_CACHE_MAX_ENTRIES=2000

# -----------------------------------------------------------------------------
# Logging Configuration
# -----------------------------------------------------------------------------

# Log level: trace, debug, info, warn, error, fatal (default: info)
LOG_LEVEL=info

# Pretty print logs for development (default: true in dev, false in prod)
LOG_PRETTY=true

# Log directory for file logging (optional)
LOG_DIR=logs

# Enable log file rotation (default: false)
ENABLE_LOG_ROTATION=false

# Maximum log file size before rotation in bytes (default: 10485760 = 10MB)
LOG_MAX_SIZE=10485760

# Maximum number of log files to keep (default: 7)
LOG_MAX_FILES=7

# -----------------------------------------------------------------------------
# Metrics & Observability
# -----------------------------------------------------------------------------

# Enable Prometheus metrics collection (default: true)
ENABLE_METRICS=true

# Metrics collection interval in milliseconds (default: 5000 = 5 seconds)
METRICS_INTERVAL_MS=5000

# Enable performance profiling (default: false)
# WARNING: Enabling profiling has performance impact
ENABLE_PROFILING=false

# Enable distributed tracing (default: false)
ENABLE_TRACING=false

# Trace sampling rate (default: 0.1 = 10%)
TRACE_SAMPLE_RATE=0.1

# -----------------------------------------------------------------------------
# Database Configuration
# -----------------------------------------------------------------------------

# User data file path (default: data/users.json)
USER_DATA_FILE=data/users.json

# Enable file locking for concurrent access (default: true)
ENABLE_FILE_LOCKING=true

# File lock retry attempts (default: 3)
FILE_LOCK_RETRIES=3

# File lock retry delay in milliseconds (default: 100)
FILE_LOCK_RETRY_DELAY_MS=100

# -----------------------------------------------------------------------------
# Feature Flags
# -----------------------------------------------------------------------------

# Enable guest sessions (default: true)
ENABLE_GUEST_SESSIONS=true

# Enable user registration (default: true)
ENABLE_USER_REGISTRATION=true

# Enable avatar uploads (default: true)
ENABLE_AVATAR_UPLOADS=true

# Enable game plugin hot-reload in development (default: true)
ENABLE_PLUGIN_HOT_RELOAD=true

# Enable undo functionality in games (default: true)
ENABLE_GAME_UNDO=true

# -----------------------------------------------------------------------------
# Development & Testing
# -----------------------------------------------------------------------------

# Enable debug mode with verbose logging (default: false)
DEBUG=false

# Enable test mode (disables some security features) (default: false)
TEST_MODE=false

# Seed for deterministic testing (optional)
TEST_SEED=

# Enable CORS for all origins in development (default: false)
# WARNING: Only use in local development
DEV_CORS_ALL=false
